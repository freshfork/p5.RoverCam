class RoverCam{constructor(t){this.sensitivity=.02,this.friction=.8,this.speed=.1,this.reset(),this.active=!0,this.enableControl=!0,this.p5=void 0!==t?t:p5.instance,null!==this.p5&&this.p5.registerMethod("post",()=>{this.active&&this.draw()}),this.keyMap={mx1:[87,38],mx2:[83,40],my1:[65,37],my2:[68,39],mz1:[69,69],mz2:[81,81],y1:[65,37],y2:[68,39],p1:[82,82],p2:[70,70],r1:[90,90],r2:[67,67],f1:[107,187],f2:[109,189],e1:[82,82],e2:[70,70]}}controller(){if(this.enableControl){var t=this.keyMap,i=this.p5;RoverCam.pointerLock?(this.yaw(i.movedX*this.sensitivity/10),this.pitch(i.movedY*this.sensitivity/10),(i.keyIsDown(t.my1[0])||i.keyIsDown(t.my1[1]))&&this.moveY(this.speed),(i.keyIsDown(t.my2[0])||i.keyIsDown(t.my2[1]))&&this.moveY(-this.speed),(i.keyIsDown(t.e1[0])||i.keyIsDown(t.e1[1]))&&this.elevate(-this.speed),(i.keyIsDown(t.e2[0])||i.keyIsDown(t.e2[1]))&&this.elevate(this.speed)):((i.keyIsDown(t.y1[0])||i.keyIsDown(t.y1[1]))&&this.yaw(-this.sensitivity),(i.keyIsDown(t.y2[0])||i.keyIsDown(t.y2[1]))&&this.yaw(this.sensitivity),(i.keyIsDown(t.p1[0])||i.keyIsDown(t.p1[1]))&&this.pitch(-this.sensitivity),(i.keyIsDown(t.p2[0])||i.keyIsDown(t.p2[1]))&&this.pitch(this.sensitivity)),(i.keyIsDown(t.mx1[0])||i.keyIsDown(t.mx1[1]))&&this.moveX(this.speed),(i.keyIsDown(t.mx2[0])||i.keyIsDown(t.mx2[1]))&&this.moveX(-this.speed),(i.keyIsDown(t.mz1[0])||i.keyIsDown(t.mz1[1]))&&this.moveZ(this.speed),(i.keyIsDown(t.mz2[0])||i.keyIsDown(t.mz2[1]))&&this.moveZ(-this.speed),(i.keyIsDown(t.f1[0])||i.keyIsDown(t.f1[1]))&&this.fov(-this.sensitivity/10),(i.keyIsDown(t.f2[0])||i.keyIsDown(t.f2[1]))&&this.fov(this.sensitivity/10)}}moveX(t){this.velocity.add(p5.Vector.mult(this.forward,t))}moveY(t){this.velocity.add(p5.Vector.mult(this.right,t))}moveZ(t){this.velocity.add(p5.Vector.mult(this.up,-t))}yaw(t){this.pan+=t}pitch(t){this.tilt+=t,this.tilt=this.clamp(this.tilt,-Math.PI/2.01,Math.PI/2.01),this.tilt==Math.PI/2&&(this.tilt+=.001)}roll(t){this.rot+=t}fov(t){this.fovy+=t,this.width=0}elevate(t){this.offset[0]+=t}usePointerLock(t){void 0===t&&(t=p5.instance),null!==t&&(RoverCam.canvas=t._renderer.elt,document.addEventListener("click",()=>{RoverCam.pointerLock?(t.exitPointerLock(),RoverCam.pointerLock=!1):(RoverCam.pointerLock=!0,t.requestPointerLock())},!1),document.addEventListener("pointerlockchange",RoverCam.onPointerlockChange,!1))}reset(){this.pan=0,this.tilt=0,this.rot=0,this.fovy=1,this.width=0,this.height=0,this.position=new p5.Vector(0,0,0),this.velocity=new p5.Vector(0,0,0),this.up=new p5.Vector(0,1,0),this.right=new p5.Vector(1,0,0),this.forward=new p5.Vector(0,0,1),this.offset=[0,0]}setActive(t){this.active=t,t&&(this.width=0)}setState(t){void 0!==t.fov&&(this.fovy=t.fov,this.width=0),void 0!==t.active&&(this.active=t.active),void 0!==t.rotation&&(this.pan=t.rotation[0],this.tilt=t.rotation[1],this.rot=t.rotation[2]),void 0!==t.position&&(this.position=new p5.Vector(t.position[0],t.position[1],t.position[2])),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.enableControl&&(this.enableControl=t.enableControl),void 0!==t.speed&&(this.speed=t.speed),void 0!==t.sensitivity&&(this.sensitivity=t.sensitivity)}draw(){this.p5.width===this.width&&this.p5.height===this.height||(this.p5.perspective(this.fovy,this.p5.width/this.p5.height,.01,1e4),this.width=this.p5.width,this.height=this.p5.height),this.controller(),this.forward=new p5.Vector(Math.cos(this.pan),Math.tan(this.tilt),Math.sin(this.pan)),this.forward.normalize(),this.right=new p5.Vector(Math.cos(this.pan-Math.PI/2),0,Math.sin(this.pan-Math.PI/2)),this.velocity.mult(this.friction),this.position.add(this.velocity);let t=p5.Vector.sub(this.position,p5.Vector.mult(this.right,this.offset[1])),i=p5.Vector.add(t,this.forward);this.p5.camera(t.x,t.y+this.offset[0],t.z,i.x,i.y+this.offset[0],i.z,this.up.x,this.up.y,this.up.z)}clamp(t,i,e){return t>e?e:t<i?i:t}}RoverCam.version="1.1.1",RoverCam.pointerLock=!1,RoverCam.onPointerlockChange=(()=>{document.pointerLockElement!==RoverCam.canvas&&document.mozPointerLockElement!==RoverCam.canvas&&(RoverCam.pointerLock=!1)}),p5.prototype.createRoverCam=function(){return new RoverCam(this)};